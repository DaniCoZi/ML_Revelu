{% set page_title = "Master Web Studio | Publicaciones" %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page_title }}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/layout.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/posts.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/forum-fixes.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-icons.css') }}">

  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap-icons/bootstrap-icons.css') }}">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital@1&display=swap" rel="stylesheet">
</head>
<body>

  {% include "forum/_forum_header.html" %}

  <div class="container">
    <div class="navigate">
      <span><a href="{{ url_for('auth.dashboard') }}">Comunidad</a> <i class="bi bi-chevron-right"></i> <a>Publicaciones</a></span>
    </div>

    <div class="posts-table">
      <div class="table-head">
        <div class="status">Estado</div>
        <div class="subjects">Temas</div>
        <div class="replies">Respuestas/Vistas</div>
        <div class="last-reply">Última actualización</div>
      </div>
      <div id="rows"></div>
    </div>

    <div class="pagination" id="pager" style="display:none;"></div>
  </div>

  <div class="note">
    <span><i class="bi bi-emoji-frown"></i>&nbsp; Tema sin interacción</span>&nbsp;&nbsp;&nbsp;<a href="#"><i class="bi bi-share"></i></a><br>
    <span><i class="bi bi-book"></i>&nbsp; Tema de baja interacción</span>&nbsp;&nbsp;&nbsp;<a href="#"><i class="bi bi-share"></i></a><br>
    <span><i class="bi bi-fire"></i>&nbsp; Tema popular</span>&nbsp;&nbsp;&nbsp;<a href="#"><i class="bi bi-share"></i></a><br>
    <span><i class="bi bi-rocket"></i>&nbsp; Tema de alta interacción</span>&nbsp;&nbsp;&nbsp;<a href="#"><i class="bi bi-share"></i></a><br>
    <span><i class="bi bi-lock"></i>&nbsp; Tema cerrado</span>&nbsp;&nbsp;&nbsp;<a href="#"><i class="bi bi-share"></i></a><br>
  </div>

  {% include "forum/_forum_footer.html" %}

  <script>
    (async ()=>{
      const rows = document.getElementById('rows');
      const esc = s => (s ?? '').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
      try{
        const r = await fetch('/api/posts');
        const data = await r.json();
        if(!Array.isArray(data) || !data.length){
          rows.innerHTML = '<div class="table-row"><div class="subjects">No hay publicaciones aún.</div></div>';
          return;
        }
        rows.innerHTML = data.map(p => {
          const created = new Date(p.created_at).toLocaleString();
          const href = "{{ url_for('auth.dashboard_detail', post_id=0) }}".replace('0', p.id);
          return `
            <div class="table-row">
              <div class="status"><i class="bi bi-chat-dots"></i></div>
              <div class="subjects">
                <a href="${href}">${esc(p.content).slice(0,120)}${p.content.length>120?'…':''}</a>
                <br><span>por ${esc(p.author || 'Usuario')}</span>
              </div>
              <div class="replies">—</div>
              <div class="last-reply">${created}</div>
            </div>`;
        }).join('');
      }catch(e){
        rows.innerHTML = '<div class="table-row"><div class="subjects">Error cargando publicaciones.</div></div>';
      }
    })();
  </script>
</body>
</html>
